<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4. Expedite Poisson-NMF estimation via alternating regression models • asapR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. Expedite Poisson-NMF estimation via alternating regression models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">asapR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">1. Introduction: We want cell topic estimation ASAP</a></li>
    <li><a class="dropdown-item" href="../articles/note_batch_correction_1_concept.html">2. Batch correction within each pseudobulk sample</a></li>
    <li><a class="dropdown-item" href="../articles/note_batch_correction_2_asap.html">3. Batch correction incorporated in ASAP</a></li>
    <li><a class="dropdown-item" href="../articles/note_faster_nmf_approximation.html">4. Expedite Poisson-NMF estimation via alternating regression models</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="note_faster_nmf_approximation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4. Expedite Poisson-NMF estimation via alternating regression models</h1>
                        <h4 data-toc-skip class="author">Yongjin Park</h4>
            
      

      <div class="d-none name"><code>note_faster_nmf_approximation.Rmd</code></div>
    </div>

    
    
<p>What if we apply single-effect Poisson regression alternatively? Let’s consider this parameterization of Poisson distribution: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\lambda_{ij} = \sum_{k} \beta_{ik} \theta_{jk}</annotation></semantics></math> Previously, we introduced <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>q</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>k</mi></msubsup><annotation encoding="application/x-tex">q_{ij}^{k}</annotation></semantics></math> (triplets for each gene <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>, cell <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>, and factor <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>) to derive closed-form variational update equations. But the overall complexity can increase in a cubic time. Can we factorize <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math> into two parts, like <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>q</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>k</mi></msubsup><mo>=</mo><msub><mi>c</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>z</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">q_{ij}^{k} = c_{ik} z_{jk}</annotation></semantics></math>? It will certainly lead to a more restrictive approximation objective. Perhaps, the lower-bound induced by the factored auxiliary variables will be not as tight as before. Still, we can show that some sort of alternating regression algorithm can benefit from having two factored auxiliary variables.</p>
<p>Let us define latent variables, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mover><mo>=</mo><mi>Δ</mi></mover><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>c</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\phi_{ik} \overset{\Delta}{=} \mathbb{E}\!\left[c_{ik}\right]</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mover><mo>=</mo><mi>Δ</mi></mover><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>z</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\rho_{jk} \overset{\Delta}{=} \mathbb{E}\!\left[z_{jk}\right]</annotation></semantics></math> under variational approximation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo stretchy="false" form="prefix">(</mo><msub><mstyle mathvariant="bold"><mi>𝐜</mi></mstyle><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ϕ</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><munder><mo>∏</mo><mi>k</mi></munder><msubsup><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></msubsup><mo>,</mo><mspace width="0.167em"></mspace><mi>q</mi><mo stretchy="false" form="prefix">(</mo><msub><mstyle mathvariant="bold"><mi>𝐳</mi></mstyle><mi>j</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ρ</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><munder><mo>∏</mo><mi>k</mi></munder><msubsup><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow><msub><mi>z</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></msubsup></mrow><annotation encoding="application/x-tex">q(\mathbf{c}_{i}|\phi_{i}) = \prod_{k} \phi_{ik}^{c_{ik}}, \, q(\mathbf{z}_{j}|\rho_{j}) = \prod_{k} \rho_{jk}^{z_{jk}}</annotation></semantics></math></p>
<div class="section level3">
<h3 id="regression-1-approximation-from-the-rows-perspective">Regression 1: Approximation from the rows’ perspective<a class="anchor" aria-label="anchor" href="#regression-1-approximation-from-the-rows-perspective"></a>
</h3>
<p>We want to estimate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{ik}</annotation></semantics></math> given <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{jk}</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><munder><mo>∑</mo><mi>k</mi></munder><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></munder><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>≥</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>k</mi></mrow></munder><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>c</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>ln</mo><mfrac><mrow><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></mfrac><mo>−</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></munder><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_{i,j} Y_{ij} \ln \left( \sum_{k} \beta_{ik} \theta_{jk} \right)
- \sum_{i,j,k} \beta_{ik}\theta_{jk}
\ge
\sum_{i,k} \sum_{j} Y_{ij} c_{ik} \ln \frac{\beta_{ik} \theta_{jk}}{c_{ik}}
- \sum_{i,j,k}\beta_{ik}\theta_{jk}</annotation></semantics></math></p>
<p>Find the most correlated factor <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math> (softly).</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ln</mo><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>=</mo><munder><munder><mfrac><mrow><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><mo>ln</mo><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo accent="true">⏟</mo></munder><mtext mathvariant="sans-serif">𝖾𝗆𝗉𝗂𝗋𝗂𝖼𝖺𝗅 𝖼𝗈𝗋𝗋𝖾𝗅𝖺𝗍𝗂𝗈𝗇</mtext></munder><mo>+</mo><munder><munder><mrow><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><mo>ln</mo><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mo accent="true">⏟</mo></munder><mtext mathvariant="sans-serif">𝗆𝖾𝗆𝗈𝗋𝗒</mtext></munder><mo>+</mo><mtext mathvariant="sans-serif">𝖼𝗈𝗇𝗌𝗍.</mtext></mrow><annotation encoding="application/x-tex">\ln \phi_{ik} = \underbrace{\frac{\sum_{j} Y_{ij} \mathbb{E}\!\left[\ln \theta_{jk}\right]}{\sum_{j} Y_{ij}}}_{\textsf{empirical correlation}}
+  \underbrace{\mathbb{E}\!\left[\ln \beta_{ik}\right]}_{\textsf{memory}} + \textsf{const.}</annotation></semantics></math></p>
<p>with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{k} \phi_{ik} = 1</annotation></semantics></math>, and <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>∼</mo><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><munder><mo>∑</mo><mi>j</mi></munder><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_{ik} \sim \operatorname{Gamma}\left(
a_{0} + \phi_{ik} \sum_{j} Y_{ij}, \,
b_{0} + \sum_{j} \mathbb{E}\!\left[\theta_{jk}\right]
\right)</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>∼</mo><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><munder><mo>∑</mo><mi>i</mi></munder><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_{jk} \sim \operatorname{Gamma}\left(
a_0 + \rho_{jk}  \sum_{i} \phi_{ik} Y_{ij} ,\,
b_0 + \sum_{i} \mathbb{E}\!\left[\beta_{ik}\right]
\right)</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="regression-2-approximation-from-the-columns-perspective">Regression 2: Approximation from the columns’ perspective<a class="anchor" aria-label="anchor" href="#regression-2-approximation-from-the-columns-perspective"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><munder><mo>∑</mo><mi>k</mi></munder><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></munder><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>≥</mo><munder><mo>∑</mo><mrow><mi>j</mi><mo>,</mo><mi>k</mi></mrow></munder><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>z</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>ln</mo><mfrac><mrow><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow><msub><mi>z</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mfrac><mo>−</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></munder><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_{i,j} Y_{ij} \ln \left( \sum_{k} \beta_{ik} \theta_{jk} \right)
- \sum_{i,j,k} \beta_{ik}\theta_{jk}
\ge
\sum_{j,k} \sum_{i} Y_{ij} z_{jk} \ln \frac{\beta_{ik} \theta_{jk}}{z_{jk}}
- \sum_{i,j,k} \beta_{ik} \theta_{jk}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ln</mo><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><munder><munder><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><mo>ln</mo><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow></mfrac><mo accent="true">⏟</mo></munder><mtext mathvariant="sans-serif">𝖾𝗆𝗉𝗂𝗋𝗂𝖼𝖺𝗅 𝖼𝗈𝗋𝗋𝖾𝗅𝖺𝗍𝗂𝗈𝗇</mtext></munder><mo>+</mo><munder><munder><mrow><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><mo>ln</mo><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mo accent="true">⏟</mo></munder><mtext mathvariant="sans-serif">𝗆𝖾𝗆𝗈𝗋𝗒</mtext></munder><mo>+</mo><mtext mathvariant="sans-serif">𝖼𝗈𝗇𝗌𝗍.</mtext></mrow><annotation encoding="application/x-tex">\ln \rho_{jk}
=
\underbrace{\frac{\sum_{i} Y_{ij} \mathbb{E}\!\left[\ln \beta_{ik}\right]}{\sum_{i} Y_{ij}}}_{\textsf{empirical correlation}}
+ \underbrace{\mathbb{E}\!\left[\ln \theta_{jk}\right]}_{\textsf{memory}}
+ \textsf{const.}</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{k} \rho_{jk} = 1</annotation></semantics></math>, and</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>∼</mo><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><munder><mo>∑</mo><mi>i</mi></munder><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_{jk} \sim \operatorname{Gamma}\left(
a_{0} + \rho_{jk} \sum_{i} Y_{ij},\,
b_{0} + \sum_{i} \mathbb{E}\!\left[\beta_{ik}\right]
\right)</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>∼</mo><mo>Gamma</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>+</mo><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>b</mi><mn>0</mn></msub><mo>+</mo><munder><mo>∑</mo><mi>j</mi></munder><mstyle mathvariant="double-struck"><mi>𝔼</mi></mstyle><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_{ik} \sim  \operatorname{Gamma}\left(
a_{0} +  \phi_{ik} \sum_{j} Y_{ij} \rho_{jk}, \,
b_{0} + \sum_{j} \mathbb{E}\!\left[\theta_{jk}\right]
\right)</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="final-remark">Final remark<a class="anchor" aria-label="anchor" href="#final-remark"></a>
</h3>
<p>As a result, we will maximize the following lower-bound:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>≥</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></munder><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>ln</mo><mfrac><mrow><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow><mrow><msub><mi>ϕ</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>ρ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub></mrow></mfrac><mo>−</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>,</mo><mi>j</mi><mo>,</mo><mi>k</mi></mrow></munder><msub><mi>β</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>θ</mi><mrow><mi>j</mi><mi>k</mi></mrow></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">L
\ge
\sum_{i,j,k} Y_{ij} \phi_{ik} \rho_{jk} \ln \frac{\beta_{ik} \theta_{jk}}{\phi_{ik} \rho_{jk}}
- \sum_{i,j,k} \beta_{ik} \theta_{jk}.</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">asapR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pheatmap</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1331</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span><span class="va">.rnorm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d1</span>,<span class="va">d2</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">d1</span> <span class="op">*</span> <span class="va">d2</span><span class="op">)</span>, <span class="va">d1</span>, <span class="va">d2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu">.rnorm</span><span class="op">(</span><span class="va">d</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">vv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu">.rnorm</span><span class="op">(</span><span class="va">n</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">uu</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">vv</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu">.rnorm</span><span class="op">(</span><span class="va">d</span>, <span class="va">n</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asap_fit_pmf.html">asap_fit_pmf</a></span><span class="op">(</span><span class="va">Y</span>, maxK<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">## 206.659 327.108  41.356</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u.order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">uu</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">log.beta</span><span class="op">[</span><span class="va">u.order</span>, <span class="op">]</span>, Rowv<span class="op">=</span><span class="cn">NA</span>, Colv<span class="op">=</span><span class="cn">NA</span>, cluster_rows <span class="op">=</span> <span class="cn">F</span>, cluster_cols <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="note_faster_nmf_approximation_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v.order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">vv</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">log.theta</span><span class="op">[</span><span class="va">v.order</span>, <span class="op">]</span>, Rowv<span class="op">=</span><span class="cn">NA</span>, Colv<span class="op">=</span><span class="cn">NA</span>, cluster_rows <span class="op">=</span> <span class="cn">F</span>, cluster_cols <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="note_faster_nmf_approximation_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yongjin Park, Sishir Subedi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
